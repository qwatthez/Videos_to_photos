<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FrameExtract</title>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #f8f7ff;
    --white: #ffffff;
    --purple: #7c3aed;
    --purple-light: #ede9fe;
    --purple-mid: #a78bfa;
    --blue: #3b82f6;
    --blue-light: #eff6ff;
    --green: #10b981;
    --green-light: #d1fae5;
    --red: #ef4444;
    --red-light: #fee2e2;
    --text: #1e1b4b;
    --muted: #6b7280;
    --border: #e5e7eb;
    --shadow: 0 1px 3px rgba(0,0,0,0.08), 0 4px 16px rgba(124,58,237,0.06);
    --shadow-hover: 0 4px 12px rgba(0,0,0,0.1), 0 8px 32px rgba(124,58,237,0.12);
    --radius: 16px;
    --radius-sm: 10px;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Plus Jakarta Sans', sans-serif;
    min-height: 100vh;
  }

  nav {
    background: var(--white);
    border-bottom: 1px solid var(--border);
    padding: 0 32px;
    height: 64px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    position: sticky;
    top: 0;
    z-index: 100;
    box-shadow: 0 1px 8px rgba(0,0,0,0.06);
  }

  .nav-logo {
    display: flex;
    align-items: center;
    gap: 10px;
    font-weight: 800;
    font-size: 18px;
    color: var(--text);
    text-decoration: none;
  }

  .nav-logo-icon {
    width: 34px;
    height: 34px;
    background: linear-gradient(135deg, var(--purple), var(--blue));
    border-radius: 8px;
    display: grid;
    place-items: center;
    color: white;
    font-size: 16px;
  }

  .nav-badge {
    background: var(--purple-light);
    color: var(--purple);
    font-size: 11px;
    font-weight: 600;
    padding: 2px 8px;
    border-radius: 20px;
  }

  main {
    max-width: 780px;
    margin: 0 auto;
    padding: 48px 24px 80px;
  }

  .hero {
    text-align: center;
    margin-bottom: 40px;
  }

  .hero-pill {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    background: var(--purple-light);
    color: var(--purple);
    font-size: 13px;
    font-weight: 600;
    padding: 6px 14px;
    border-radius: 20px;
    margin-bottom: 20px;
  }

  .hero h1 {
    font-size: clamp(26px, 5vw, 40px);
    font-weight: 800;
    line-height: 1.15;
    margin-bottom: 12px;
    background: linear-gradient(135deg, var(--text) 0%, var(--purple) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .hero p {
    color: var(--muted);
    font-size: 15px;
    line-height: 1.6;
    max-width: 460px;
    margin: 0 auto;
  }

  .card {
    background: var(--white);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    padding: 28px;
    margin-bottom: 16px;
    border: 1px solid var(--border);
  }

  .card-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 20px;
  }

  .card-icon {
    width: 40px;
    height: 40px;
    border-radius: 10px;
    display: grid;
    place-items: center;
    font-size: 18px;
    flex-shrink: 0;
  }

  .icon-purple { background: var(--purple-light); }
  .icon-blue   { background: var(--blue-light); }
  .icon-green  { background: var(--green-light); }

  .card-header-text h2 { font-size: 15px; font-weight: 700; }
  .card-header-text p  { font-size: 12px; color: var(--muted); margin-top: 2px; }

  /* Drop zone */
  .drop-zone {
    border: 2px dashed var(--border);
    border-radius: var(--radius-sm);
    padding: 36px 24px;
    text-align: center;
    cursor: pointer;
    transition: all 0.2s;
    position: relative;
    background: var(--bg);
  }

  .drop-zone:hover, .drop-zone.drag-over {
    border-color: var(--purple);
    background: var(--purple-light);
  }

  .drop-zone input[type="file"] {
    position: absolute;
    inset: 0;
    opacity: 0;
    cursor: pointer;
    width: 100%;
    height: 100%;
  }

  .drop-icon-wrap {
    width: 52px;
    height: 52px;
    background: var(--white);
    border-radius: 12px;
    display: grid;
    place-items: center;
    margin: 0 auto 12px;
    box-shadow: var(--shadow);
    font-size: 22px;
  }

  .drop-zone h3 { font-size: 14px; font-weight: 700; margin-bottom: 4px; }
  .drop-zone p  { font-size: 13px; color: var(--muted); }
  .drop-zone p span { color: var(--purple); font-weight: 600; }

  .file-chips { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 14px; }

  .chip {
    display: flex;
    align-items: center;
    gap: 7px;
    background: var(--bg);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 5px 10px;
    font-size: 12px;
    font-weight: 500;
  }

  .chip-remove {
    color: var(--muted);
    cursor: pointer;
    font-size: 15px;
    line-height: 1;
    transition: color 0.15s;
  }
  .chip-remove:hover { color: var(--red); }

  /* Params */
  .params-grid {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: 14px;
  }
  @media (max-width: 540px) { .params-grid { grid-template-columns: 1fr; } }

  .param-item label {
    display: block;
    font-size: 11px;
    font-weight: 700;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 0.4px;
    margin-bottom: 7px;
  }

  .param-item input[type="number"] {
    width: 100%;
    padding: 10px 12px;
    border: 1.5px solid var(--border);
    border-radius: 8px;
    font-family: inherit;
    font-size: 14px;
    font-weight: 600;
    color: var(--text);
    background: var(--white);
    outline: none;
    transition: border-color 0.2s, box-shadow 0.2s;
  }

  .param-item input[type="number"]:focus {
    border-color: var(--purple);
    box-shadow: 0 0 0 3px var(--purple-light);
  }

  .param-item .hint { font-size: 11px; color: var(--muted); margin-top: 5px; }

  .slider-container { display: flex; align-items: center; gap: 10px; }

  input[type="range"] {
    flex: 1;
    -webkit-appearance: none;
    height: 4px;
    border-radius: 2px;
    background: var(--border);
    outline: none;
    cursor: pointer;
  }

  input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 18px;
    height: 18px;
    border-radius: 50%;
    background: var(--purple);
    cursor: pointer;
    box-shadow: 0 1px 4px rgba(124,58,237,0.4);
    border: 2px solid white;
  }

  .slider-val { font-size: 13px; font-weight: 700; color: var(--purple); min-width: 36px; text-align: right; }

  /* Button */
  .btn-primary {
    width: 100%;
    padding: 15px;
    background: linear-gradient(135deg, var(--purple), var(--blue));
    color: white;
    border: none;
    border-radius: var(--radius-sm);
    font-family: inherit;
    font-size: 15px;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.2s;
    box-shadow: 0 4px 14px rgba(124,58,237,0.35);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    margin-bottom: 16px;
  }

  .btn-primary:hover:not(:disabled) {
    transform: translateY(-1px);
    box-shadow: 0 6px 20px rgba(124,58,237,0.45);
  }

  .btn-primary:disabled {
    opacity: 0.45;
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
  }

  /* Progress */
  #progress-card { display: none; }
  #upload-card   { display: none; }
  #success-card  { display: none; }

  .stats-row {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
    margin-bottom: 20px;
  }

  .stat-box {
    background: var(--bg);
    border-radius: 8px;
    padding: 12px;
    text-align: center;
  }

  .stat-val { font-size: 20px; font-weight: 800; color: var(--purple); }
  .stat-lbl { font-size: 11px; color: var(--muted); font-weight: 500; margin-top: 2px; }

  .progress-track {
    height: 10px;
    background: var(--purple-light);
    border-radius: 99px;
    overflow: hidden;
    margin-bottom: 10px;
  }

  .progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--purple), var(--blue));
    border-radius: 99px;
    width: 0%;
    transition: width 0.5s ease;
    position: relative;
  }

  .progress-fill::after {
    content: '';
    position: absolute;
    right: 0; top: 0;
    width: 50px;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.5));
    animation: shine 1.2s infinite;
  }

  @keyframes shine {
    0%   { opacity: 0; }
    50%  { opacity: 1; }
    100% { opacity: 0; }
  }

  .progress-meta {
    display: flex;
    justify-content: space-between;
    font-size: 12px;
    color: var(--muted);
    font-weight: 500;
    margin-bottom: 10px;
  }

  .progress-file {
    font-size: 12px;
    color: var(--muted);
    padding: 9px 12px;
    background: var(--bg);
    border-radius: 8px;
    font-weight: 500;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  /* Upload bar */
  .upload-track {
    height: 6px;
    background: var(--blue-light);
    border-radius: 99px;
    overflow: hidden;
    margin-top: 10px;
  }

  .upload-fill {
    height: 100%;
    background: var(--blue);
    border-radius: 99px;
    width: 0%;
    transition: width 0.3s;
  }

  /* Success */
  .success-inner {
    text-align: center;
    padding: 10px 0;
  }

  .success-icon {
    width: 60px;
    height: 60px;
    background: var(--green-light);
    border-radius: 50%;
    display: grid;
    place-items: center;
    margin: 0 auto 14px;
    font-size: 26px;
  }

  .success-inner h3 { font-size: 18px; font-weight: 800; margin-bottom: 5px; }
  .success-inner p  { color: var(--muted); font-size: 13px; margin-bottom: 20px; }

  .btn-download {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    background: var(--green);
    color: white;
    padding: 13px 28px;
    border-radius: var(--radius-sm);
    font-family: inherit;
    font-size: 14px;
    font-weight: 700;
    text-decoration: none;
    transition: all 0.2s;
    box-shadow: 0 4px 14px rgba(16,185,129,0.3);
  }

  .btn-download:hover {
    transform: translateY(-1px);
    box-shadow: 0 6px 20px rgba(16,185,129,0.4);
  }

  .error-box {
    display: none;
    background: var(--red-light);
    border: 1px solid #fca5a5;
    border-radius: var(--radius-sm);
    padding: 12px 16px;
    font-size: 13px;
    color: var(--red);
    font-weight: 500;
    margin-bottom: 16px;
  }
</style>
</head>
<body>

<nav>
  <a class="nav-logo" href="#">
    <div class="nav-logo-icon">üé¨</div>
    FrameExtract
  </a>
  <span class="nav-badge">v1.0</span>
</nav>

<main>

  <div class="hero">
    <div class="hero-pill">‚ú® Extraction automatique d'images</div>
    <h1>Transformez vos vid√©os<br>en images en un clic</h1>
    <p>Uploadez vos fichiers MP4, MOV ou AVI, r√©glez vos param√®tres et t√©l√©chargez le r√©sultat en ZIP.</p>
  </div>

  <!-- Fichiers -->
  <div class="card">
    <div class="card-header">
      <div class="card-icon icon-purple">üìÅ</div>
      <div class="card-header-text">
        <h2>S√©lectionner vos vid√©os</h2>
        <p>MP4, MOV, AVI ‚Äî plusieurs fichiers accept√©s</p>
      </div>
    </div>
    <div class="drop-zone" id="drop-zone">
      <input type="file" id="file-input" accept=".mp4,.mov,.avi" multiple>
      <div class="drop-icon-wrap">üìΩÔ∏è</div>
      <h3>Glissez vos vid√©os ici</h3>
      <p>ou <span>parcourir vos fichiers</span></p>
    </div>
    <div class="file-chips" id="file-chips"></div>
  </div>

  <!-- Param√®tres -->
  <div class="card">
    <div class="card-header">
      <div class="card-icon icon-blue">‚öôÔ∏è</div>
      <div class="card-header-text">
        <h2>Param√®tres d'extraction</h2>
        <p>Personnalisez le r√©sultat selon vos besoins</p>
      </div>
    </div>
    <div class="params-grid">
      <div class="param-item">
        <label>Intervalle (s)</label>
        <input type="number" id="interval_s" value="1" min="0.1" step="0.1">
        <div class="hint">1 image toutes les N secondes</div>
      </div>
      <div class="param-item">
        <label>D√©lai d√©part (s)</label>
        <input type="number" id="delay_s" value="0.5" min="0" step="0.1">
        <div class="hint">Ignorer le d√©but de la vid√©o</div>
      </div>
      <div class="param-item">
        <label>Taille des images</label>
        <div class="slider-container">
          <input type="range" id="resize_factor" min="10" max="100" value="100" step="5">
          <span class="slider-val" id="resize-display">100%</span>
        </div>
        <div class="hint">100% = taille originale</div>
      </div>
    </div>
  </div>

  <!-- Erreur -->
  <div class="error-box" id="error-box"></div>

  <!-- Bouton -->
  <button class="btn-primary" id="btn-extract" onclick="startExtraction()" disabled>
    ‚ñ∂&nbsp; Lancer l'extraction
  </button>

  <!-- Upload en cours -->
  <div class="card" id="upload-card">
    <div class="card-header" style="margin-bottom:10px;">
      <div class="card-icon icon-blue">‚¨ÜÔ∏è</div>
      <div class="card-header-text">
        <h2>Upload en cours‚Ä¶</h2>
        <p id="upload-label">Envoi des fichiers vers le serveur</p>
      </div>
    </div>
    <div class="upload-track">
      <div class="upload-fill" id="upload-fill"></div>
    </div>
  </div>

  <!-- Extraction en cours -->
  <div class="card" id="progress-card">
    <div class="card-header">
      <div class="card-icon icon-purple">‚ö°</div>
      <div class="card-header-text">
        <h2>Extraction en cours‚Ä¶</h2>
        <p id="progress-subtitle">Traitement de vos vid√©os</p>
      </div>
    </div>
    <div class="stats-row">
      <div class="stat-box">
        <div class="stat-val" id="stat-pct">0%</div>
        <div class="stat-lbl">Progression</div>
      </div>
      <div class="stat-box">
        <div class="stat-val" id="stat-frames">0</div>
        <div class="stat-lbl">Images extraites</div>
      </div>
      <div class="stat-box">
        <div class="stat-val" id="stat-files">‚Äî</div>
        <div class="stat-lbl">Fichiers</div>
      </div>
    </div>
    <div class="progress-track">
      <div class="progress-fill" id="progress-fill"></div>
    </div>
    <div class="progress-meta">
      <span id="progress-status">Initialisation‚Ä¶</span>
      <span id="progress-pct">0%</span>
    </div>
    <div class="progress-file" id="progress-file">‚Äî</div>
  </div>

  <!-- Succ√®s -->
  <div class="card" id="success-card">
    <div class="success-inner">
      <div class="success-icon">‚úÖ</div>
      <h3>Extraction termin√©e !</h3>
      <p id="success-info">Vos images sont pr√™tes.</p>
      <a id="download-link" class="btn-download" href="#">‚¨á&nbsp; T√©l√©charger le ZIP</a>
    </div>
  </div>

</main>

<script>
  let selectedFiles = [];
  let currentJobId = null;
  let pollTimer = null;

  // Slider
  document.getElementById('resize_factor').addEventListener('input', function () {
    document.getElementById('resize-display').textContent = this.value + '%';
  });

  // Drag & Drop
  const dropZone = document.getElementById('drop-zone');
  const fileInput = document.getElementById('file-input');

  dropZone.addEventListener('dragover', e => { e.preventDefault(); dropZone.classList.add('drag-over'); });
  dropZone.addEventListener('dragleave', () => dropZone.classList.remove('drag-over'));
  dropZone.addEventListener('drop', e => {
    e.preventDefault();
    dropZone.classList.remove('drag-over');
    addFiles([...e.dataTransfer.files]);
  });
  fileInput.addEventListener('change', () => { addFiles([...fileInput.files]); fileInput.value = ''; });

  function addFiles(files) {
    files.filter(f => f.name.match(/\.(mp4|mov|avi)$/i)).forEach(f => {
      if (!selectedFiles.find(x => x.name === f.name)) selectedFiles.push(f);
    });
    renderChips();
    document.getElementById('btn-extract').disabled = selectedFiles.length === 0;
  }

  function removeFile(name) {
    selectedFiles = selectedFiles.filter(f => f.name !== name);
    renderChips();
    document.getElementById('btn-extract').disabled = selectedFiles.length === 0;
  }

  function renderChips() {
    document.getElementById('file-chips').innerHTML = selectedFiles.map(f => `
      <div class="chip">
        <span>üéûÔ∏è</span>
        <span>${f.name}</span>
        <span class="chip-remove" onclick="removeFile('${f.name}')">√ó</span>
      </div>`).join('');
  }

  function show(id) { document.getElementById(id).style.display = 'block'; }
  function hide(id) { document.getElementById(id).style.display = 'none'; }

  async function startExtraction() {
    if (!selectedFiles.length) return;

    document.getElementById('btn-extract').disabled = true;
    hide('error-box');
    hide('success-card');
    hide('progress-card');
    show('upload-card');
    document.getElementById('upload-fill').style.width = '0%';

    const fd = new FormData();
    selectedFiles.forEach(f => fd.append('videos', f));
    fd.append('interval_s', document.getElementById('interval_s').value);
    fd.append('delay_s', document.getElementById('delay_s').value);
    const resize = parseInt(document.getElementById('resize_factor').value);
    fd.append('resize_factor', (resize / 100).toString());

    try {
      const jobId = await uploadWithProgress(fd);
      currentJobId = jobId;
      hide('upload-card');
      document.getElementById('stat-files').textContent = `0/${selectedFiles.length}`;
      show('progress-card');
      startPolling(jobId);
    } catch (e) {
      hide('upload-card');
      showError(e.message);
      document.getElementById('btn-extract').disabled = false;
    }
  }

  function uploadWithProgress(fd) {
    return new Promise((resolve, reject) => {
      const xhr = new XMLHttpRequest();
      xhr.open('POST', '/upload');

      xhr.upload.onprogress = e => {
        if (e.lengthComputable) {
          const pct = Math.round(e.loaded / e.total * 100);
          document.getElementById('upload-fill').style.width = pct + '%';
          document.getElementById('upload-label').textContent =
            `Envoi‚Ä¶ ${pct}% (${fmt(e.loaded)} / ${fmt(e.total)})`;
        }
      };

      xhr.onload = () => {
        try {
          const d = JSON.parse(xhr.responseText);
          if (d.error) reject(new Error(d.error));
          else resolve(d.job_id);
        } catch { reject(new Error('R√©ponse invalide du serveur')); }
      };

      xhr.onerror = () => reject(new Error('Erreur r√©seau ‚Äî v√©rifiez votre connexion'));
      xhr.send(fd);
    });
  }

  function startPolling(jobId) {
    pollTimer = setInterval(async () => {
      try {
        const res = await fetch(`/progress/${jobId}`);
        if (!res.ok) return;
        const d = await res.json();

        const pct = d.progress || 0;
        document.getElementById('progress-fill').style.width = pct + '%';
        document.getElementById('stat-pct').textContent = pct + '%';
        document.getElementById('progress-pct').textContent = pct + '%';
        document.getElementById('stat-frames').textContent = d.frames_done || 0;
        document.getElementById('stat-files').textContent =
          `${d.files_done || 0}/${d.total_files || selectedFiles.length}`;

        if (d.current_file) {
          document.getElementById('progress-file').textContent = 'üìÑ ' + d.current_file;
          document.getElementById('progress-status').textContent = 'Traitement en cours‚Ä¶';
        }

        if (d.status === 'done') {
          clearInterval(pollTimer);
          hide('progress-card');
          document.getElementById('success-info').textContent =
            `${d.total_frames || '?'} images extraites avec succ√®s.`;
          document.getElementById('download-link').href = `/download/${jobId}`;
          show('success-card');
          document.getElementById('btn-extract').disabled = false;
        } else if (d.status === 'error') {
          clearInterval(pollTimer);
          hide('progress-card');
          showError(d.error || 'Erreur inconnue lors du traitement.');
          document.getElementById('btn-extract').disabled = false;
        }
      } catch (_) { /* ignore erreurs r√©seau temporaires */ }
    }, 600);
  }

  function showError(msg) {
    const el = document.getElementById('error-box');
    el.textContent = '‚ö†Ô∏è ' + msg;
    el.style.display = 'block';
  }

  function fmt(bytes) {
    return bytes < 1048576
      ? (bytes / 1024).toFixed(0) + ' Ko'
      : (bytes / 1048576).toFixed(1) + ' Mo';
  }
</script>
</body>
</html>
